<!DOCTYPE html>
<html>
<head> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/> 
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
<meta name="viewport" content="width=device-width, user-scalable=0, initial-scale=1.0, maximum-scale=1.0;" />
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
<script type="text/javascript" src="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){
      window.URL = window.URL || window.webkitURL;
      $("#stopButton").hide();
      $("#startButton").hide();

      $("#uploadButton").click(function(e) {
          e.preventDefault();
          $("#fileChoose0").click();
      });

      $("#fileChoose0").live('change', function() {
         $("#infoDiv").hide();

         var req = new XMLHttpRequest();
         req.open("POST", "uppp.php", true);
         req.onload = function(event) { 
            if (req.readyState === 4) {  
               if (req.status === 200) {  
                  console.log(req.responseText);
                  var au = document.getElementById('audio1');
                  var rsp = JSON.parse(req.responseText);
                  $("#resImage").attr("src", rsp.img);
                  au.src = rsp.snd;
                  au.load();
                  au.play();
                  $("#stopButton").show();
                  $("#startButton").show();
               } else {  
                  console.log("Error", req.statusText);  
                  alert(req.statusText);
               }  
            }  
         };
         var form = document.forms.namedItem("uploadForm");

//localStorage.getItem("");
//localStorage.setItem("name", "Hello World!");

         var fd = new FormData(form); 
         req.send(fd);

          $.each(this.files, function (i,file){
            if (!file.type.match(/image.*/)) {
              return;
            }

            var reader = new FileReader();
            reader.onload = (function(theFile) {
              return function(e) {
                 $("#srcImage").attr("data-file", theFile);
                 $("#srcImage").attr("src", e.target.result);
              };
            })(file);
            // Read in the image file as a data URL.
            reader.readAsDataURL(file);
          });

      });

      $("#stopButton").click(function(e) {
          e.preventDefault();
          document.getElementById('audio1').pause();
      });

      $("#startButton").click(function(e) {
          e.preventDefault();
          document.getElementById('audio1').play();
      });

      $("#cameraButton").click(function(e) {
          alert("Not implemented yet");
      });


      $("#simplifyCheck").click(function() {
       alert('Handler called. ' + $("#simplifyCheck"));
      });

});
</script>

<title>Mobile Bitmaps and Waves</title> 
</head> 
 
<body>
<div data-role="page" id="home" name="home">
   <div align="center">
      <a id="adButton" data-inline="false" data-role="button" 
         href="http://victorx.eu" data-theme="a" data-corners="false">
         Bitmaps and Waves</a>
   </div><!-- header -->

   <div align="center" data-role="content">
      <div align="center" id="infoDiv">
        This service converts images to sounds.
      </div> <!-- info text -->

      <img id="srcImage" width="200px"/>
      <img id="resImage" width="200px"/>

      <audio id="audio1" preload="auto">AUDIO</audio>
      <form id="uploadFormPost" name="uploadForm" 
            enctype="multipart/form-data" action="uppp.php" method="POST" 
            data-ajax='false'>
         <input type="hidden" name="MAX_FILE_SIZE" value="2000000" />
<!-- fieldset data-role="controlgroup" data-type="horizontal" data-mini="false" -->
         <label for="simplify">Simplify image</label>
         <input type="checkbox" name="simplify" id="simplify" value="yes" />
<!-- /fieldset -->
         <input type="file" id="fileChoose0" name="uploadedfile" 
            multiple="false" accept="image/jpeg" style="height:0;width:0;"/>
      </form>
   </div> <!-- content -->

   <div data-role="footer" align="center">
      <a id="uploadButton" data-icon="arrow-u" data-inline="true" 
         data-role="button" data-theme="b" 
         data-iconpos="left">Upload an Image File</a>
      <!--a id="cameraButton" data-inline="true" data-role="button" 
         data-theme="b" data-iconpos="left">Take a Picture</a -->
      <a id="startButton" data-icon="arrow-r" data-inline="true" 
         data-role="button" data-theme="b" data-iconpos="left">Play</a>
      <a id="stopButton" data-icon="delete" data-inline="true" 
         data-role="button" data-theme="b" data-iconpos="left">Stop</a>
      <a href="#options" data-icon="gear" data-inline="true"
         data-role="button" data-theme="b">Options</a>
   </div> <!-- footer -->
</div> <!-- home page-->

<div data-role="page" id="options" name="options">
   <div align="center">
      <a id="adButton" data-inline="false" data-role="button" 
         href="http://victorx.eu" data-theme="a" data-corners="false">
         Bitmaps and Waves</a>
   </div><!-- header -->

   <div data-role="content" align="center">

<fieldset data-role="controlgroup" data-type="vertical" data-mini="false">
<input type="checkbox" name="simplifyCheck" id="simplifyCheck" value="simplify"/>
<label for="simplifyCheck">Simplify image</label>
</fieldset>
   </div> <!-- content -->

   <div data-role="footer" align="center">
      <a href="#home" data-icon="arrow-l" data-role="button"
         data-inline="true" data-theme="b">Back</a>
   </div> <!-- footer -->
</div> <!-- options page-->

</body>
</html>
